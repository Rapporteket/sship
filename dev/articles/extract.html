<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extract cargo from a secure shipment • sship</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract cargo from a secure shipment">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sship</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/overview.html">An overwiev of sship</a></li>
    <li><a class="dropdown-item" href="../articles/ship.html">Make a secure shipment</a></li>
    <li><a class="dropdown-item" href="../articles/extract.html">Extract cargo from a secure shipment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rapporteket/sship/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Extract cargo from a secure shipment</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/sship/blob/main/vignettes/extract.Rmd" class="external-link"><code>vignettes/extract.Rmd</code></a></small>
      <div class="d-none name"><code>extract.Rmd</code></div>
    </div>

    
    
<p>Content as provided by <em>sship</em> has to be extracted and
decrypted in order for the recipient to gain access the actual content.
The prerequisite is that the recipient holds the private key associated
with the public key used for encryption. This key pair must have been
generated using the RSA crypto system and should use 2048 bits key size,
or more. The recipient may use tools within <em>sship</em> to establish
the associated content or any other tool that handle the <a href="https://rapporteket.github.io/sship/articles/overview.html" class="external-link">cryptographic
algorithms applied by <em>sship</em></a>.</p>
<div class="section level2">
<h2 id="conventions">Conventions<a class="anchor" aria-label="anchor" href="#conventions"></a>
</h2>
<p>The following conventions and assumptions are used:</p>
<ul>
<li>cargo of shipment is found within a compressed file named
<code>[filename]__[datestamp]_[timestamp].tar.gz</code> where
<code>[filename]</code> is the name of the file that was encrypted prior
to shipment, <code>[datestamp]</code> is the date of shipment formatted
as <em>YYYYMMDD</em> and <code>[timestamp]</code> is the time of
shipment formatted as <em>HHMMSS</em>
</li>
<li>for the below examples the filename
<code>data.csv__20200101_081500.tar.gz</code> will be used</li>
<li>the above file exists in the current working directory</li>
<li>the private key is represented by the file
<code>~/.ssh/id_rsa</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="extract-and-decrypt-content-in-r">Extract and decrypt content in R<a class="anchor" aria-label="anchor" href="#extract-and-decrypt-content-in-r"></a>
</h2>
<p>Install the latest version of the <em>sship</em> packages from the R
command prompt:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Rapporteket/sship"</span><span class="op">)</span></span></code></pre></div>
<p>and load it into the R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/Rapporteket/sship" class="external-link">"sship"</a></span><span class="op">)</span></span></code></pre></div>
<p>Use the <code><a href="../reference/dec.html">dec()</a></code>-function to extract and decrypt the
content:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dec.html">dec</a></span><span class="op">(</span>tarfile <span class="op">=</span> <span class="st">"data.csv__20200101_081500.tar.gz"</span>,</span>
<span>    keyfile <span class="op">=</span> <span class="st">"~/.ssh/id_rsa"</span>,</span>
<span>    target_dir <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>From the example above the file <code>data.csv</code> will be written
to the current working directory. Please use</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">dec</span></span></code></pre></div>
<p>at the R prompt for more information.</p>
</div>
<div class="section level2">
<h2 id="extract-and-decrypt-content-outside-r">Extract and decrypt content outside R<a class="anchor" aria-label="anchor" href="#extract-and-decrypt-content-outside-r"></a>
</h2>
<p>Extraction and decryption of content that was encrypted and packed by
<em>sship</em> (in R) is perfectly possible also outside R. In the above
R-function a few things is taken care of “under the hood” and to aid a
better understanding more information should be added to the above list
of “conventions”:</p>
<ul>
<li>when encrypting content <em>sship</em> uses the AES block cipher in
CBC mode applying a key of 256 random bits (32 bytes long)</li>
<li>when encryption content <em>sship</em> uses an initialization vector
of 128 random bits (16 bytes long)</li>
<li>the shipment, <em>i.e.</em> the compressed tar archive file,
consists of three files that will be named (according to the current
example):
<ul>
<li>
<code>data.csv.enc</code>: the encrypted data of the shipment</li>
<li>
<code>key.enc</code>: the encrypted key</li>
<li>
<code>iv</code>: the initialization vector used for encryption and
decryption</li>
</ul>
</li>
<li>just for the record then, names of encrypted files ends with
<code>.enc</code>
</li>
<li>the filename of the original content (data) is represented by the
first part of the archive filename (shipment) up until the double
underscore (<em>__</em>), <em>e.g.</em> given the archive filename
<code>data.csv__20200101_081500.tar.gz</code> the decrypted content will
be established in the file <code>data.csv</code>
</li>
</ul>
<p>Below is an example of how
<code>data.csv__20200101_081500.tar.gz</code> can be processed from a
Bash shell (unix) command prompt. First, extract the archive:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xvzf</span> data.csv__20200101_081500.tar.gz</span></code></pre></div>
<p>Then, decrypt the key by using the private key:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">openssl</span> rsautl <span class="at">-decrypt</span> <span class="at">-inkey</span> ~/.ssh/id_rsa <span class="at">-in</span> key.enc <span class="at">-out</span> key</span></code></pre></div>
<p>Finally, decrypt the content to the file <code>data.csv</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">openssl</span> aes-256-cbc <span class="at">-d</span> <span class="at">-in</span> data.csv.enc <span class="at">-out</span> data.csv <span class="dt">\</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>-K <span class="va">$(</span><span class="fu">hexdump</span> <span class="at">-e</span> <span class="st">'32/1 "%02x"'</span> key<span class="va">)</span> <span class="at">-iv</span> <span class="va">$(</span><span class="fu">hexdump</span> <span class="at">-e</span> <span class="st">'16/1 "%02x"'</span> iv<span class="va">)</span></span></code></pre></div>
<p>In the above example both the <code>key</code> and <code>iv</code>
files are binary. When using OpenSSL for decryption these have to be
provided as strings of hexadecimal digits as can be seen by the use of
inline <em>hexdump</em> conversion in the last command. Methods for
conversion from binary to hex may vary between systems. It might also be
worth noting that here AES uses a key directly and not a (hash of some)
passphrase that often will be the case elsewhere.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
