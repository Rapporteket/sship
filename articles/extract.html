<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extract cargo from a secure shipment • sship</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extract cargo from a secure shipment">
<meta property="og:description" content="sship">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sship</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">An overwiev of sship</a>
    </li>
    <li>
      <a href="../articles/ship.html">Make a secure shipment</a>
    </li>
    <li>
      <a href="../articles/extract.html">Extract cargo from a secure shipment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/Rapporteket/sship/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extract_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extract cargo from a secure shipment</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/Rapporteket/sship/blob/master/vignettes/extract.Rmd"><code>vignettes/extract.Rmd</code></a></small>
      <div class="hidden name"><code>extract.Rmd</code></div>

    </div>

    
    
<p>Content as provided by <em>sship</em> has to be extracted and decrypted in order for the recipient to gain access the actual content. The prerequisite is that the recipient holds the private key associated with the public key used for encryption. This key pair must have been generated using the RSA crypto system and should use 2048 bits key size, or more. The recipient may use tools within <em>sship</em> to establish the associated content or any other tool that handle the <a href="https://rapporteket.github.io/sship/articles/overview.html">cryptographic algorithms applied by <em>sship</em></a>.</p>
<div id="conventions" class="section level2">
<h2 class="hasAnchor">
<a href="#conventions" class="anchor"></a>Conventions</h2>
<p>The following conventions and assumptions are used:</p>
<ul>
<li>cargo of shipment is found within a compressed file named <code>[filename]__[datestamp]_[timestamp].tar.gz</code> where <code>[filename]</code> is the name of the file that was encrypted prior to shipment, <code>[datestamp]</code> is the date of shipment formatted as <em>YYYYMMDD</em> and <code>[timestamp]</code> is the time of shipment formatted as <em>HHMMSS</em>
</li>
<li>for the below examples the filename <code>data.csv__20200101_081500.tar.gz</code> will be used</li>
<li>the above file exists in the current working directory</li>
<li>the private key is represented by the file <code>~/.ssh/id_rsa</code>
</li>
</ul>
</div>
<div id="extract-and-decrypt-content-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-and-decrypt-content-in-r" class="anchor"></a>Extract and decrypt content in R</h2>
<p>Install the latest version of the <em>sship</em> packages from the R command prompt:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"Rapporteket/sship"</span><span class="op">)</span></code></pre></div>
<p>and load it into the R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://github.com/Rapporteket/sship">"sship"</a></span><span class="op">)</span></code></pre></div>
<p>Use the <code><a href="../reference/dec.html">dec()</a></code>-function to extract and decrypt the content:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dec.html">dec</a></span><span class="op">(</span>tarfile <span class="op">=</span> <span class="st">"data.csv__20200101_081500.tar.gz"</span>,
    keyfile <span class="op">=</span> <span class="st">"~/.ssh/id_rsa"</span>,
    target_dir <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<p>From the example above the file <code>data.csv</code> will be written to the current working directory. Please use</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">dec</span></code></pre></div>
<p>at the R prompt for more information.</p>
</div>
<div id="extract-and-decrypt-content-outside-r" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-and-decrypt-content-outside-r" class="anchor"></a>Extract and decrypt content outside R</h2>
<p>Extraction and decryption of content that was encrypted and packed by <em>sship</em> (in R) is perfectly possible also outside R. In the above R-function a few things is taken care of “under the hood” and to aid a better understanding more information should be added to the above list of “conventions”:</p>
<ul>
<li>when encrypting content <em>sship</em> uses the AES block chiper in CBC mode applying a key of 256 random bits (32 bytes long)</li>
<li>when encryption content <em>sship</em> uses an initialization vector of 128 random bits (16 bytes long)</li>
<li>the shipment, <em>i.e.</em> the compressed tar archive file, consists of three files that will be named (according to the current example):
<ul>
<li>
<code>data.csv.enc</code>: the encrypted data of the shipment</li>
<li>
<code>key.enc</code>: the encrypted key</li>
<li>
<code>iv</code>: the initialization vector used for encryption and decryption</li>
</ul>
</li>
<li>just for the record then, names of encrypted files ends with <code>.enc</code>
</li>
<li>the filename of the original content (data) is represented by the first part of the archive filename (shipment) up until the double underscore (<em>__</em>), <em>e.g.</em> given the archive filename <code>data.csv__20200101_081500.tar.gz</code> the decrypted content will be established in the file <code>data.csv</code>
</li>
</ul>
<p>Below is an example of how <code>data.csv__20200101_081500.tar.gz</code> can be processed from a Bash shell (unix) command propt. First, extract the archive:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">tar</span> -xvzf data.csv__20200101_081500.tar.gz</span></code></pre></div>
<p>Then, decrypt the key by using the private key:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="ex">openssl</span> rsautl -decrypt -inkey ~/.ssh/id_rsa -in key.enc -out key</span></code></pre></div>
<p>Finally, decrypt the content to the file <code>data.csv</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="ex">openssl</span> aes-256-cbc -d -in data.csv.enc -out data.csv \</span>
<span id="cb7-2"><a href="#cb7-2"></a>-K <span class="va">$(</span><span class="fu">hexdump</span> -e <span class="st">'32/1 "%02x"'</span> key<span class="va">)</span> -iv <span class="va">$(</span><span class="fu">hexdump</span> -e <span class="st">'16/1 "%02x"'</span> iv<span class="va">)</span></span></code></pre></div>
<p>In the above example both the <code>key</code> and <code>iv</code> files are binary. When using OpenSSL for decryption these have to be provided as strings of hexadecimal digits as can be seen by the use of inline <em>hexdump</em> conversion in the last command. Methods for conversion from binary to hex may vary between systems. It might also be worth noting that here AES uses a key directly and not a (hash of some) passphrase that often will be the case elsewhere.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Are Edvardsen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
